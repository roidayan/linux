From fb7dff4f61e63e48d32d5cc3fc5e9defaaaeb2b9 Mon Sep 17 00:00:00 2001
From: Vladimir Sokolovsky <vlad@mellanox.com>
Date: Wed, 28 Nov 2012 16:34:38 +0200
Subject: [PATCH] BACKPORT: Added ipoib support for 3.5 kernel

Signed-off-by: Vladimir Sokolovsky <vlad@mellanox.com>
---
 drivers/infiniband/ulp/ipoib/ipoib_cm.c |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/drivers/infiniband/ulp/ipoib/ipoib_cm.c b/drivers/infiniband/ulp/ipoib/ipoib_cm.c
index ce61c78..96d7778 100644
--- a/drivers/infiniband/ulp/ipoib/ipoib_cm.c
+++ b/drivers/infiniband/ulp/ipoib/ipoib_cm.c
@@ -1466,7 +1466,11 @@ static void ipoib_cm_update_pmtu_task(struct work_struct *work)
 		container_of(work, struct ipoib_pmtu_update, work);
 	struct sk_buff *skb = pmtu_update->skb;
 
+#if LINUX_VERSION_CODE >= KERNEL_VERSION(3,6,0)
 	skb_dst(skb)->ops->update_pmtu(skb_dst(skb), NULL, skb, pmtu_update->mtu);
+#else
+	skb_dst(skb)->ops->update_pmtu(skb_dst(skb), pmtu_update->mtu);
+#endif
 
 	consume_skb(skb);
 
-- 
1.6.0.2

